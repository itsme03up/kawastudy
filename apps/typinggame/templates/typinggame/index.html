<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}

{% block title %}ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ {% endblock %}

{% block extra_css %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- React ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
<div id="react-typing-game">
    <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šReact ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆã®å¾“æ¥ç‰ˆ -->
    <div class="container my-5">
        <div id="panel" class="inner">
            <div id="header">
                <div class="stats-container">
                    <span>å•é¡Œ: <span id="question-number">1</span>/<span id="total-questions">10</span></span>
                    <span>æ®‹ã‚Šæ™‚é–“: <span id="time">60.0</span></span>
                    <span>WPM: <span id="wpm">0</span></span>
                    <span>æ­£è§£ç‡: <span id="accuracy">0.00</span>%</span>
                </div>
            </div>

            <div id="text-container">
                <div id="text-display" class="fs-2">
                    {{ question.japanese }}
                </div>
                <div id="romaji-display" class="fs-4 text-muted">
                    {{ question.romaji }}
                </div>
            </div>

            <div id="overlay">
                <div class="fs-4">ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§é–‹å§‹</div>
                <div class="mt-2 text-muted">ï¼ˆæ—¥æœ¬èªå…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ã¯ã‚ªãƒ•ã«ã—ã¦ãã ã•ã„ï¼‰</div>
            </div>
            <div id="message"></div>
        </div>
    </div>
</div>

<script>
    // Django ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ React ã«æ¸¡ã™
    window.typingQuestionsData = JSON.parse('{{ questions_json|safe }}');
    window.typingInitialQuestion = JSON.parse('{{ initial_question_json|safe }}');
</script>
{% endblock %}

{% block react_scripts %}
<!-- ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚° -->
<script>
    console.log('ğŸ”§ Template DEBUG: Starting script execution - v2');
    console.log('ğŸ”§ React container exists:', !!document.getElementById('react-typing-game'));
    console.log('ğŸ”§ Questions data:', window.typingQuestionsData);
    console.log('ğŸ”§ Initial question:', window.typingInitialQuestion);
</script>

<!-- React ã®ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ç›´æ¥èª­ã¿è¾¼ã¿ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ã‚¿ãƒ¼ä»˜ã) -->
<script src="{% static 'js/react/typing.bundle.js' %}?v={{ forloop.counter|default:'1' }}"></script>

<script>
    console.log('ğŸ”§ After bundle load - checking window objects - v2');
    console.log('ğŸ”§ React available:', typeof React !== 'undefined');
    console.log('ğŸ”§ ReactDOM available:', typeof ReactDOM !== 'undefined');
    
    // æ‰‹å‹•ã§Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã¿ã‚‹
    setTimeout(() => {
        console.log('ğŸ”§ Manual React initialization attempt - v2');
        const container = document.getElementById('react-typing-game');
        if (container) {
            console.log('ğŸ”§ Container found, trying to render...');
            try {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¦ç´ ã‚’éè¡¨ç¤º
                const fallback = container.querySelector('.container');
                if (fallback) {
                    fallback.style.display = 'none';
                    console.log('ğŸ”§ Fallback hidden');
                }
                console.log('ğŸ”§ Manual initialization complete');
            } catch (error) {
                console.error('ğŸ”§ Manual initialization failed:', error);
            }
        } else {
            console.error('ğŸ”§ Container not found!');
        }
    }, 100);
    
    console.log('ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ  React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ - v2');
</script>
{% endblock %}
