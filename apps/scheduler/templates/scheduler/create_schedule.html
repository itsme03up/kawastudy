{% extends 'base.html' %}
{% load static %}

{% block title %}新しいスケジュール作成 - 川田との学習デート{% endblock %}

{% block body_class %}create-schedule{% endblock %}

{% block extra_css %}
<style>
.create-schedule {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    padding: 2rem 0;
}

.schedule-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 0 1rem;
}

.schedule-header {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 2rem;
}

.schedule-header h1 {
    font-size: 2.2rem;
    margin-bottom: 0.5rem;
    color: #34495e;
    font-weight: 600;
}

.schedule-form {
    background: white;
    border-radius: 15px;
    padding: 2.5rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid #e9ecef;
}

.kawada-greeting {
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    color: white;
    display: flex;
    align-items: center;
    gap: 1rem;
    border: 2px solid #ddd;
}

.kawada-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.kawada-text {
    flex: 1;
}

.kawada-text h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.kawada-text p {
    margin: 0;
    opacity: 0.95;
    font-size: 0.95rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.form-control {
    width: 100%;
    padding: 1rem;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-sizing: border-box;
    color: #495057;
}

.form-control:focus {
    outline: none;
    border-color: #74b9ff;
    box-shadow: 0 0 0 3px rgba(116, 185, 255, 0.1);
}

.datetime-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.app-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 0.5rem;
}

.app-option {
    position: relative;
}

.app-option input[type="radio"] {
    display: none;
}

.app-option label {
    display: block;
    padding: 1rem;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
    color: #495057;
}

.app-option label:hover {
    border-color: #74b9ff;
    background: #e3f2fd;
}

.app-option input[type="radio"]:checked + label {
    border-color: #74b9ff;
    background: #74b9ff;
    color: white;
}

.app-icon {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 0.5rem;
}

.app-name {
    font-size: 0.9rem;
    font-weight: 600;
}

.submit-section {
    margin-top: 2rem;
    text-align: center;
}

.btn-submit {
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    color: white;
    padding: 1rem 3rem;
    border: none;
    border-radius: 25px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 3px 10px rgba(116, 185, 255, 0.3);
}

.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
    background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%);
}

.btn-cancel {
    background: transparent;
    color: #6c757d;
    padding: 1rem 2rem;
    border: 2px solid #6c757d;
    border-radius: 25px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    margin-left: 1rem;
    transition: all 0.3s ease;
}

.btn-cancel:hover {
    background: #6c757d;
    color: white;
    text-decoration: none;
}

.suggested-times {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 0.5rem;
    border: 1px solid #e9ecef;
}

.suggested-times h4 {
    margin: 0 0 0.5rem 0;
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 600;
}

.time-suggestions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.time-suggestion {
    background: #74b9ff;
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 12px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    border: 1px solid #74b9ff;
}

.time-suggestion:hover {
    background: #0984e3;
    border-color: #0984e3;
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .schedule-form {
        padding: 1.5rem;
    }
    
    .datetime-group {
        grid-template-columns: 1fr;
    }
    
    .app-selector {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .kawada-greeting {
        flex-direction: column;
        text-align: center;
    }
    
    .btn-cancel {
        margin-left: 0;
        margin-top: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="schedule-container">
    <div class="schedule-header">
        <h1>� 川田との学習予定</h1>
        <p>一緒に計画的な学習時間を作りましょう</p>
    </div>

    <div class="schedule-form">
        <div class="kawada-greeting">
            <div class="kawada-avatar">😊</div>
            <div class="kawada-text">
                <h3>一緒に学習計画を立てましょう！</h3>
                <p>継続的な学習で着実に成長していきましょうね</p>
            </div>
        </div>

        <form method="post" id="scheduleForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label class="form-label" for="title">📝 タイトル</label>
                <input type="text" 
                       id="title" 
                       name="title" 
                       class="form-control" 
                       placeholder="例：SQLクイズで腕試し、C言語の復習など"
                       required>
            </div>

            <div class="form-group">
                <label class="form-label" for="description">📖 説明（任意）</label>
                <textarea id="description" 
                          name="description" 
                          class="form-control" 
                          rows="3"
                          placeholder="学習の詳細や目標を記入してください"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">🎯 学習内容</label>
                <div class="app-selector">
                    {% for app_code, app_name in apps_choices %}
                    <div class="app-option">
                        <input type="radio" 
                               id="app_{{ app_code }}" 
                               name="app_name" 
                               value="{{ app_code }}"
                               {% if request.GET.app == app_code %}checked{% endif %}>
                        <label for="app_{{ app_code }}">
                            <span class="app-icon">
                                {% if app_code == 'cstudy' %}💻
                                {% elif app_code == 'sqlquiz' %}🗄️
                                {% elif app_code == 'chatlesson' %}💬
                                {% elif app_code == 'linuxfun' %}🐧
                                {% elif app_code == 'aws' %}☁️
                                {% elif app_code == 'typinggame' %}⌨️
                                {% else %}📚{% endif %}
                            </span>
                            <span class="app-name">{{ app_name }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">📅 日時</label>
                <div class="datetime-group">
                    <div>
                        <input type="date" 
                               id="scheduled_date" 
                               name="scheduled_date" 
                               class="form-control"
                               min="{{ today|date:'Y-m-d' }}"
                               required>
                    </div>
                    <div>
                        <input type="time" 
                               id="scheduled_time" 
                               name="scheduled_time" 
                               class="form-control"
                               required>
                    </div>
                </div>
                
                <div class="suggested-times">
                    <h4>🕐 おすすめの時間帯</h4>
                    <div class="time-suggestions">
                        <span class="time-suggestion" onclick="setTime('09:00')">朝活 9:00</span>
                        <span class="time-suggestion" onclick="setTime('12:00')">お昼 12:00</span>
                        <span class="time-suggestion" onclick="setTime('15:00')">午後 15:00</span>
                        <span class="time-suggestion" onclick="setTime('18:00')">夕方 18:00</span>
                        <span class="time-suggestion" onclick="setTime('21:00')">夜 21:00</span>
                    </div>
                </div>
            </div>

            <div class="submit-section">
                <button type="submit" class="btn-submit">
                    � 学習予定を作成する
                </button>
                <a href="{% url 'scheduler:dashboard' %}" class="btn-cancel">
                    キャンセル
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// 今日の日付をデフォルトに設定
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    const dateInput = document.getElementById('scheduled_date');
    if (!dateInput.value) {
        dateInput.value = tomorrow.toISOString().split('T')[0];
    }
    
    // デフォルトの時間を設定
    const timeInput = document.getElementById('scheduled_time');
    if (!timeInput.value) {
        timeInput.value = '21:00';
    }
});

// 時間提案のクリック処理
function setTime(time) {
    document.getElementById('scheduled_time').value = time;
}

// フォーム送信時の川田のリアクション
document.getElementById('scheduleForm').addEventListener('submit', function(e) {
    const kawadaText = document.querySelector('.kawada-text');
    kawadaText.innerHTML = `
        <h3>学習予定が決まりましたね！</h3>
        <p>計画的な学習で着実に成長していきましょう</p>
    `;
    
    const kawadaAvatar = document.querySelector('.kawada-avatar');
    kawadaAvatar.textContent = '�';
});

// アプリ選択時の川田のリアクション
document.querySelectorAll('input[name="app_name"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const kawadaText = document.querySelector('.kawada-text');
        const kawadaAvatar = document.querySelector('.kawada-avatar');
        
        const reactions = {
            'cstudy': {
                text: 'C言語ですね！プログラミングの基本をしっかり学びましょう💻',
                emoji: '🤓'
            },
            'sqlquiz': {
                text: 'SQLクイズ！データベースの知識を深めていきましょう🗄️',
                emoji: '�'
            },
            'chatlesson': {
                text: 'ChatLesson！楽しく会話しながら学習しましょう💬',
                emoji: '😊'
            },
            'linuxfun': {
                text: 'Linux！コマンドラインをマスターしていきましょう🐧',
                emoji: '😎'
            },
            'aws': {
                text: 'AWS！クラウド技術を一緒に学習しましょう☁️',
                emoji: '🤓'
            },
            'typinggame': {
                text: 'タイピング！基礎スキルを鍛えていきましょう⌨️',
                emoji: '💪'
            }
        };
        
        const reaction = reactions[this.value];
        if (reaction) {
            kawadaText.innerHTML = `
                <h3>${reaction.text}</h3>
                <p>計画的に学習を進めていきましょう</p>
            `;
            kawadaAvatar.textContent = reaction.emoji;
        }
    });
});
</script>
{% endblock %}
