{% extends 'base.html' %}

{% block title %}æ¥½ã—ã„Linux - Kawada Study{% endblock %}

{% block extra_css %}
<style>
.terminal {
    background: #000;
    color: #00ff00;
    font-family: "Courier New", "Monaco", "Menlo", monospace;
    padding: 20px;
    height: 80vh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

.terminal-header {
    background: #333;
    color: #fff;
    padding: 10px 20px;
    margin: -20px -20px 20px -20px;
    border-radius: 8px 8px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
}

.terminal-controls {
    display: flex;
    gap: 8px;
}

.terminal-btn {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.btn-close { background: #ff5f56; }
.btn-minimize { background: #ffbd2e; }
.btn-maximize { background: #27ca3f; }

.log-area {
    overflow-y: auto;
    flex-grow: 1;
    white-space: pre-wrap;
    font-size: 14px;
    line-height: 1.4;
    padding-bottom: 10px;
}

.log-area::-webkit-scrollbar {
    width: 8px;
}

.log-area::-webkit-scrollbar-track {
    background: #111;
}

.log-area::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}

.log-area::-webkit-scrollbar-thumb:hover {
    background: #555;
}

.input-area {
    display: flex;
    align-items: center;
    border-top: 1px solid #333;
    padding-top: 10px;
}

.prompt {
    color: #00ff00;
    margin-right: 8px;
    font-weight: bold;
}

input#commandInput {
    background: transparent;
    border: none;
    color: #00ff00;
    font-family: inherit;
    font-size: 14px;
    flex-grow: 1;
    outline: none;
    padding: 0;
}

input#commandInput::placeholder {
    color: #666;
}

.command-output {
    color: #fff;
    margin-left: 0;
}

.error-output {
    color: #ff6b6b;
}

.success-output {
    color: #51cf66;
}

.container-fluid {
    padding: 20px;
}

.back-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    text-decoration: none;
    transition: background 0.3s;
}

.back-btn:hover {
    background: rgba(0, 0, 0, 0.9);
    color: white;
    text-decoration: none;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <a href="{% url 'home' %}" class="back-btn">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
    
    <div id="terminal" class="terminal">
        <div class="terminal-header">
            <span>ğŸ§ Linux Terminal - å·ç”°å…ˆç”Ÿã¨ä¸€ç·’ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¦šãˆã‚ˆã†ï¼</span>
            <div class="terminal-controls">
                <div class="terminal-btn btn-close"></div>
                <div class="terminal-btn btn-minimize"></div>
                <div class="terminal-btn btn-maximize"></div>
            </div>
        </div>
        
        <div id="log" class="log-area">Welcome to Kawada Linux Terminal! ğŸ§
Type 'help' to see available commands.

</div>
        
        <div class="input-area">
            <span class="prompt">kawada@linux:~$</span>
            <input type="text" id="commandInput" autocomplete="off" placeholder="ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." />
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const commandInput = document.getElementById('commandInput');
    const logArea = document.getElementById('log');
    
    // ã‚³ãƒãƒ³ãƒ‰å±¥æ­´
    let commandHistory = [];
    let historyIndex = -1;
    
    // åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ã¨å¿œç­”
    const commands = {
        'help': () => {
            return `åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:
  help      - ã“ã®ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
  echo      - ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º (ä¾‹: echo Hello World)
  date      - ç¾åœ¨ã®æ—¥æ™‚ã‚’è¡¨ç¤º
  whoami    - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤º
  pwd       - ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¡¨ç¤º
  ls        - ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤º
  clear     - ç”»é¢ã‚’ã‚¯ãƒªã‚¢
  uname     - ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã‚’è¡¨ç¤º
  fortune   - ä»Šæ—¥ã®é‹å‹¢ã‚’è¡¨ç¤º`;
        },
        
        'echo': (args) => {
            return args.join(' ');
        },
        
        'date': () => {
            return new Date().toLocaleString('ja-JP');
        },
        
        'whoami': () => {
            return 'kawada';
        },
        
        'pwd': () => {
            return '/home/kawada';
        },
        
        'ls': () => {
            return `total 8
drwxr-xr-x  2 kawada kawada 4096 Jul 31 12:00 Documents
drwxr-xr-x  2 kawada kawada 4096 Jul 31 12:00 Downloads
-rw-r--r--  1 kawada kawada  220 Jul 31 12:00 .bashrc
-rw-r--r--  1 kawada kawada  807 Jul 31 12:00 .profile`;
        },
        
        'clear': () => {
            logArea.textContent = 'Welcome to Kawada Linux Terminal! ğŸ§\nType \'help\' to see available commands.\n\n';
            return null;
        },
        
        'uname': () => {
            return 'Linux kawada-linux 5.15.0 #1 SMP x86_64 GNU/Linux';
        },
        
        'fortune': () => {
            const fortunes = [
                'ä»Šæ—¥ã¯æ–°ã—ã„ã“ã¨ã‚’å­¦ã¶ã®ã«æœ€é©ãªæ—¥ã§ã™ï¼ ğŸŒŸ',
                'ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚Œã°ã€ãã£ã¨ç´ æ™´ã‚‰ã—ã„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚Œã¾ã™ã‚ˆï¼ ğŸ’»',
                'å¤±æ•—ã‚’æã‚Œãšã€ã©ã‚“ã©ã‚“ã‚³ãƒãƒ³ãƒ‰ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ ğŸš€',
                'Linuxã®ä¸–ç•Œã¯åºƒå¤§ã§ã™ã€‚ä¸€æ­©ãšã¤é€²ã‚“ã§ã„ãã¾ã—ã‚‡ã†ï¼ ğŸ§',
                'ä»Šæ—¥è¦šãˆãŸã‚³ãƒãƒ³ãƒ‰ã¯ã€æ˜æ—¥ã®ã‚ãªãŸã‚’åŠ©ã‘ã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†ï¼ âœ¨'
            ];
            return fortunes[Math.floor(Math.random() * fortunes.length)];
        }
    };
    
    function addToLog(text, className = '') {
        const span = document.createElement('span');
        if (className) {
            span.className = className;
        }
        span.textContent = text + '\n';
        logArea.appendChild(span);
        logArea.scrollTop = logArea.scrollHeight;
    }
    
    function processCommand(input) {
        const args = input.trim().split(/\s+/);
        const command = args[0].toLowerCase();
        const commandArgs = args.slice(1);
        
        // ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ã‚°ã«è¡¨ç¤º
        addToLog(`kawada@linux:~$ ${input}`);
        
        if (command === '') {
            return;
        }
        
        // ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã«è¿½åŠ 
        commandHistory.unshift(input);
        if (commandHistory.length > 50) {
            commandHistory.pop();
        }
        historyIndex = -1;
        
        if (commands[command]) {
            const output = commands[command](commandArgs);
            if (output !== null) {
                addToLog(output, 'command-output');
            }
        } else {
            addToLog(`bash: ${command}: command not found`, 'error-output');
            addToLog('ãƒ’ãƒ³ãƒˆ: "help" ã‚³ãƒãƒ³ãƒ‰ã§åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ã‚’ç¢ºèªã§ãã¾ã™', 'success-output');
        }
        
        addToLog(''); // ç©ºè¡Œã‚’è¿½åŠ 
    }
    
    // Enterã‚­ãƒ¼ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
    commandInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const input = e.target.value;
            processCommand(input);
            e.target.value = '';
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex > 0) {
                historyIndex--;
                commandInput.value = commandHistory[historyIndex];
            } else if (historyIndex === 0) {
                historyIndex = -1;
                commandInput.value = '';
            }
        }
    });
    
    // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    document.getElementById('terminal').addEventListener('click', function() {
        commandInput.focus();
    });
    
    // åˆæœŸãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    commandInput.focus();
});
</script>
{% endblock %}
