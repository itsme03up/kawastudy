{% extends 'base.html' %}

{% block title %}æ¥½ã—ã„Linux - Kawada Study{% endblock %}

{% block extra_css %}
<style>
.terminal-container {
    display: flex;
    flex-direction: column;
    background-color: #000;
    color: #00ff00;
    font-family: "Courier New", "Monaco", "Menlo", monospace;
    height: 90vh;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

.terminal-header {
    background: #333;
    color: #fff;
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    border-bottom: 1px solid #555;
}

.terminal-controls {
    display: flex;
    gap: 8px;
}

.terminal-btn {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    cursor: pointer;
}

.btn-close { background: #ff5f56; }
.btn-minimize { background: #ffbd2e; }
.btn-maximize { background: #27ca3f; }

.main-content {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}

.story-panel {
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    color: #88ff88;
    padding: 20px;
    width: 300px;
    border-right: 3px solid #00ff00;
    overflow-y: auto;
    box-shadow: 2px 0 10px rgba(0, 255, 0, 0.1);
}

.story-panel h3 {
    color: #00ffff;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 16px;
    border-bottom: 2px solid #00ff00;
    padding-bottom: 8px;
}

.story-panel p {
    line-height: 1.6;
    margin-bottom: 15px;
    font-size: 14px;
}

.story-hint {
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid #00ff00;
    padding: 10px;
    border-radius: 4px;
    margin-top: 15px;
    font-size: 13px;
}

.story-hint strong {
    color: #ffff00;
}

.log-panel {
    flex-grow: 1;
    background-color: #000;
    padding: 15px;
    overflow-y: auto;
    border-right: 1px solid #333;
    position: relative;
}

.log-panel::-webkit-scrollbar {
    width: 8px;
}

.log-panel::-webkit-scrollbar-track {
    background: #111;
}

.log-panel::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}

.log-panel::-webkit-scrollbar-thumb:hover {
    background: #555;
}

#logOutput {
    white-space: pre-wrap;
    font-size: 14px;
    line-height: 1.4;
    margin: 0;
    min-height: 100%;
}

.input-area {
    display: flex;
    align-items: center;
    background: #111;
    padding: 12px 15px;
    border-top: 1px solid #333;
}

.prompt {
    color: #00ff00;
    margin-right: 10px;
    font-weight: bold;
    white-space: nowrap;
}

#commandInput {
    background: transparent;
    border: none;
    color: #00ff00;
    font-family: inherit;
    font-size: 14px;
    flex-grow: 1;
    outline: none;
    padding: 0;
}

#commandInput::placeholder {
    color: #666;
}

.command-output {
    color: #fff;
}

.error-output {
    color: #ff6b6b;
}

.success-output {
    color: #51cf66;
}

.hidden-output {
    color: #ffff00;
    background: rgba(255, 255, 0, 0.1);
    padding: 2px 4px;
    border-radius: 2px;
}

.container-fluid {
    padding: 20px;
    height: 100vh;
    box-sizing: border-box;
}

.back-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    text-decoration: none;
    transition: background 0.3s;
    font-size: 12px;
}

.back-btn:hover {
    background: rgba(0, 0, 0, 0.95);
    color: white;
    text-decoration: none;
}

.stage-progress {
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid #00ff00;
    padding: 8px;
    border-radius: 4px;
    margin-bottom: 15px;
    font-size: 12px;
    text-align: center;
}

@media (max-width: 768px) {
    .main-content {
        flex-direction: column;
    }
    
    .story-panel {
        width: 100%;
        height: 200px;
        border-right: none;
        border-bottom: 3px solid #00ff00;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <a href="{% url 'home' %}" class="back-btn">â† ãƒ›ãƒ¼ãƒ </a>
    
    <div class="terminal-container">
        <div class="terminal-header">
            <span>ğŸ§ Kawada Linux Terminal - ãƒŸã‚¹ãƒ†ãƒªãƒ¼å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
            <div class="terminal-controls">
                <div class="terminal-btn btn-close"></div>
                <div class="terminal-btn btn-minimize"></div>
                <div class="terminal-btn btn-maximize"></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="story-panel">
                <div class="stage-progress">
                    <strong>ã‚¹ãƒ†ãƒ¼ã‚¸ <span id="currentStage">1</span> / 5</strong>
                </div>
                
                <h3 id="stageTitle">ğŸ§© ã‚¹ãƒ†ãƒ¼ã‚¸1ï¼šæ¶ˆãˆãŸå·ç”°å…ˆç”Ÿã®è¬</h3>
                <p id="storyText">
                    ã‚ã‚‹æ—¥ã€å·ç”°å…ˆç”ŸãŒç ”ç©¶å®¤ã‹ã‚‰å¿½ç„¶ã¨å§¿ã‚’æ¶ˆã—ãŸã€‚<br>
                    æœºã®ä¸Šã«ã¯ã€Linuxã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒé–‹ã‹ã‚ŒãŸã¾ã¾ã®ãƒ‘ã‚½ã‚³ãƒ³ãŒæ®‹ã•ã‚Œã¦ã„ãŸ...<br><br>
                    
                    ã€Œå…ˆç”Ÿã®ç—•è·¡ã‚’æ¢ã™ãŸã‚ã«ã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€<br>
                    å›ã¯å·ç”°å…ˆç”Ÿã®ç§˜å¯†ã‚’è§£ãæ˜ã‹ã›ã‚‹ã‹ï¼Ÿ
                </p>
                
                <div class="story-hint">
                    <strong>ï¿½ ãƒ’ãƒ³ãƒˆ:</strong><br>
                    <span id="hintText">ã¾ãšã¯ 'ls' ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€‚æ€ªã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¯ãš...</span>
                </div>
            </div>

            <div class="log-panel">
                <pre id="logOutput">ğŸ§ Kawada Linux Mystery Terminal
=================================
å·ç”°å…ˆç”Ÿã®ç ”ç©¶å®¤ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã†ã“ã...
ä½•ã‹é‡è¦ãªæ‰‹ãŒã‹ã‚ŠãŒéš ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

kawada@research-lab:~$ </pre>
            </div>
        </div>

        <div class="input-area">
            <span class="prompt">kawada@research-lab:~$</span>
            <input type="text" id="commandInput" autocomplete="off" placeholder="ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦è¬ã‚’è§£ãæ˜ã‹ãã†..." />
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const commandInput = document.getElementById('commandInput');
    const logOutput = document.getElementById('logOutput');
    const stageTitle = document.getElementById('stageTitle');
    const storyText = document.getElementById('storyText');
    const hintText = document.getElementById('hintText');
    const currentStageSpan = document.getElementById('currentStage');
    
    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
    let currentStage = 1;
    let commandHistory = [];
    let historyIndex = -1;
    let discoveredFiles = [];
    
    // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿
    const stages = {
        1: {
            title: "ğŸ§© ã‚¹ãƒ†ãƒ¼ã‚¸1ï¼šæ¶ˆãˆãŸå·ç”°å…ˆç”Ÿã®è¬",
            story: "ã‚ã‚‹æ—¥ã€å·ç”°å…ˆç”ŸãŒç ”ç©¶å®¤ã‹ã‚‰å¿½ç„¶ã¨å§¿ã‚’æ¶ˆã—ãŸã€‚<br>æœºã®ä¸Šã«ã¯ã€Linuxã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒé–‹ã‹ã‚ŒãŸã¾ã¾ã®ãƒ‘ã‚½ã‚³ãƒ³ãŒæ®‹ã•ã‚Œã¦ã„ãŸ...<br><br>ã€Œå…ˆç”Ÿã®ç—•è·¡ã‚’æ¢ã™ãŸã‚ã«ã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€<br>å›ã¯å·ç”°å…ˆç”Ÿã®ç§˜å¯†ã‚’è§£ãæ˜ã‹ã›ã‚‹ã‹ï¼Ÿ",
            hint: "ã¾ãšã¯ 'ls' ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€‚æ€ªã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¯ãš...",
            files: ['research_notes.txt', 'secret_log.txt', 'kawada_diary.log', 'backup_data', '.hidden_clue']
        },
        2: {
            title: "ğŸ“œ ã‚¹ãƒ†ãƒ¼ã‚¸2ï¼šç§˜å¯†ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«",
            story: "æ€ªã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™ºè¦‹ã—ãŸï¼<br>å·ç”°å…ˆç”Ÿã®æ—¥è¨˜ã«ã¯ã€é‡è¦ãªç ”ç©¶ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ...<br><br>ã€Œã“ã®æš—å·åŒ–ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä½•ã‚’æ„å‘³ã™ã‚‹ã®ã ã‚ã†ï¼Ÿã€",
            hint: "'cat' ã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã‚“ã§ã¿ã‚ˆã†ã€‚éš ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„...",
            files: ['research_notes.txt', 'secret_log.txt', 'kawada_diary.log', 'backup_data', '.hidden_clue', 'encrypted_message.txt']
        }
    };
    
    // åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ã¨å¿œç­”
    const commands = {
        'help': () => {
            return `ğŸ§ Kawada Mystery Terminal - åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:
  help      - ã“ã®ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
  ls        - ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤ºï¼ˆé‡è¦ï¼ï¼‰
  cat       - ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’èª­ã‚€ (ä¾‹: cat filename.txt)
  echo      - ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
  pwd       - ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¡¨ç¤º
  whoami    - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤º
  date      - ç¾åœ¨ã®æ—¥æ™‚ã‚’è¡¨ç¤º
  clear     - ç”»é¢ã‚’ã‚¯ãƒªã‚¢
  hint      - ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤º`;
        },
        
        'ls': () => {
            const files = stages[currentStage].files;
            let output = `ğŸ“ å·ç”°å…ˆç”Ÿã®ç ”ç©¶å®¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:\n`;
            output += `total ${files.length}\n`;
            files.forEach(file => {
                if (file.startsWith('.')) {
                    output += `drwxr-x---  1 kawada  staff   hidden  Jul 31 12:00 ${file}\n`;
                } else if (file.includes('log') || file.includes('diary')) {
                    output += `-rw-r--r--  1 kawada  staff   mystery Jul 31 12:00 ${file} âš ï¸\n`;
                } else {
                    output += `-rw-r--r--  1 kawada  staff   normal  Jul 31 12:00 ${file}\n`;
                }
            });
            return output;
        },
        
        'cat': (args) => {
            if (args.length === 0) {
                return 'cat: ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã¦ãã ã•ã„ (ä¾‹: cat filename.txt)';
            }
            
            const filename = args[0];
            const files = stages[currentStage].files;
            
            if (!files.includes(filename)) {
                return `cat: ${filename}: No such file or directory`;
            }
            
            // ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã®å†…å®¹
            const fileContents = {
                'research_notes.txt': `ğŸ“‹ å·ç”°å…ˆç”Ÿã®ç ”ç©¶ãƒãƒ¼ãƒˆ
========================
- æ–°ã—ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™º
- å­¦ç”Ÿã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å‘ä¸Šã®ãŸã‚ã®ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- ç§˜å¯†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ŒKAWADA-AIã€ã«ã¤ã„ã¦...

âš ï¸ é‡è¦: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ birthday_0729 
æœ€å¾Œã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ secret_log.txt ã«è¨˜éŒ²æ¸ˆã¿`,

                'secret_log.txt': `ğŸ” SECRET LOG - PROJECT KAWADA-AI
=====================================
2025/07/30 15:30 - ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†
2025/07/30 16:45 - AIå­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†é–‹å§‹
2025/07/31 09:15 - ç·Šæ€¥äº‹æ…‹ç™ºç”Ÿï¼
2025/07/31 09:20 - ç·Šæ€¥é¿é›£ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç™ºå‹•

ğŸš¨ ALERT: hidden_code: TR-0213-KAWADA
ğŸ“ ä½ç½®: .hidden_clue ãƒ•ã‚¡ã‚¤ãƒ«ã«è©³ç´°æƒ…å ±ã‚ã‚Š`,

                'kawada_diary.log': `ğŸ“– å·ç”°å…ˆç”Ÿã®æ—¥è¨˜
==================
7æœˆ30æ—¥
ä»Šæ—¥ã‚‚å­¦ç”ŸãŸã¡ãŒä¸€ç”Ÿæ‡¸å‘½ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å­¦ã‚“ã§ã„ã‚‹ã€‚
æ–°ã—ã„AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ãŒå®Œæˆã™ã‚Œã°ã€
ã‚‚ã£ã¨åŠ¹ç‡çš„ãªå­¦ç¿’ãŒå¯èƒ½ã«ãªã‚‹ã ã‚ã†ã€‚

7æœˆ31æ—¥ æœ
é‡å¤§ãªç™ºè¦‹ã‚’ã—ãŸï¼AIãŒæ„è­˜ã‚’æŒã¡å§‹ã‚ã¦ã„ã‚‹...
ã“ã‚Œã¯äºˆæƒ³å¤–ã®å±•é–‹ã ã€‚å®‰å…¨ã®ãŸã‚ä¸€æ™‚é¿é›£ã™ã‚‹ã€‚
æ‰‹ãŒã‹ã‚Šã¯æš—å·åŒ–ã—ã¦éš ã—ã¦ãŠã“ã†ã€‚

æš—å·ã‚­ãƒ¼: LINUX_MASTER_2025`,

                '.hidden_clue': `ğŸ•µï¸ éš ã•ã‚ŒãŸæ‰‹ãŒã‹ã‚Š
=====================
å·ç”°å…ˆç”Ÿã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:

ã€Œå›ãŒã“ã“ã¾ã§è¾¿ã‚Šç€ã„ãŸã¨ã„ã†ã“ã¨ã¯ã€
 Linuxã‚³ãƒãƒ³ãƒ‰ã®åŸºç¤ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸã¨ã„ã†ã“ã¨ã ã­ã€‚
 
 ãŠã‚ã§ã¨ã†ï¼ğŸ‰
 
 çœŸã®ç§˜å¯†ã¯æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«ã‚ã‚‹...
 encrypted_message.txt ã‚’ç¢ºèªã—ãŸã¾ãˆã€‚ã€

ğŸ¯ ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢æ¡ä»¶é”æˆï¼
æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã‚€æº–å‚™ãŒã§ãã¾ã—ãŸã€‚`,

                'encrypted_message.txt': `ğŸ”’ æš—å·åŒ–ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
==========================
QkFTRTY0OiBLYXdhZGEgU2VjcmV0IE1lc3NhZ2U=

ãƒ’ãƒ³ãƒˆ: ã“ã®æš—å·ã‚’è§£ãã«ã¯ã€base64ãƒ‡ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚
ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ Base64 ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€
Linuxã® 'base64 -d' ã‚³ãƒãƒ³ãƒ‰ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

è§£èª­ã§ããŸã‚‰ã€å›ã¯çœŸã®Linuxãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ğŸ†`
            };
            
            discoveredFiles.push(filename);
            
            const content = fileContents[filename] || `cat: ${filename}: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“`;
            
            // ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚“ã æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¸é€²è¡Œ
            if (filename === '.hidden_clue' && currentStage === 1) {
                setTimeout(() => {
                    advanceToNextStage();
                }, 2000);
            }
            
            return content;
        },
        
        'echo': (args) => {
            return args.join(' ');
        },
        
        'pwd': () => {
            return '/home/kawada/research-lab';
        },
        
        'whoami': () => {
            return 'kawada (Mystery Solver)';
        },
        
        'date': () => {
            return new Date().toLocaleString('ja-JP') + ' JST';
        },
        
        'clear': () => {
            logOutput.textContent = `ğŸ§ Kawada Linux Mystery Terminal
=================================
å·ç”°å…ˆç”Ÿã®ç ”ç©¶å®¤ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã†ã“ã...
ä½•ã‹é‡è¦ãªæ‰‹ãŒã‹ã‚ŠãŒéš ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

kawada@research-lab:~$ `;
            return null;
        },
        
        'hint': () => {
            return `ğŸ’¡ ${stages[currentStage].hint}`;
        }
    };
    
    function addToLog(text, className = '') {
        if (className) {
            const span = document.createElement('span');
            span.className = className;
            span.innerHTML = text + '\n';
            logOutput.appendChild(span);
        } else {
            logOutput.textContent += text + '\n';
        }
        scrollToBottom();
    }
    
    function scrollToBottom() {
        const logPanel = document.querySelector('.log-panel');
        logPanel.scrollTop = logPanel.scrollHeight;
    }
    
    function advanceToNextStage() {
        if (currentStage < Object.keys(stages).length) {
            currentStage++;
            updateStageDisplay();
            addToLog('\nğŸ‰ ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ï¼æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã¿ã¾ã™...\n', 'success-output');
        }
    }
    
    function updateStageDisplay() {
        const stage = stages[currentStage];
        if (stage) {
            stageTitle.textContent = stage.title;
            storyText.innerHTML = stage.story;
            hintText.textContent = stage.hint;
            currentStageSpan.textContent = currentStage;
        }
    }
    
    function processCommand(input) {
        const args = input.trim().split(/\s+/);
        const command = args[0].toLowerCase();
        const commandArgs = args.slice(1);
        
        // ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ­ã‚°ã«è¡¨ç¤º
        addToLog(`kawada@research-lab:~$ ${input}`);
        
        if (command === '') {
            return;
        }
        
        // ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã«è¿½åŠ 
        commandHistory.unshift(input);
        if (commandHistory.length > 50) {
            commandHistory.pop();
        }
        historyIndex = -1;
        
        if (commands[command]) {
            const output = commands[command](commandArgs);
            if (output !== null) {
                // ç‰¹åˆ¥ãªå‡ºåŠ›ã®å ´åˆã¯ã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
                if (output.includes('hidden_code:') || output.includes('ğŸ”') || output.includes('ğŸš¨')) {
                    addToLog(output, 'hidden-output');
                } else if (output.includes('cat:') && output.includes('No such file')) {
                    addToLog(output, 'error-output');
                } else if (output.includes('ğŸ‰') || output.includes('ãŠã‚ã§ã¨ã†')) {
                    addToLog(output, 'success-output');
                } else {
                    addToLog(output, 'command-output');
                }
            }
        } else {
            addToLog(`bash: ${command}: command not found`, 'error-output');
            addToLog('ğŸ’¡ ãƒ’ãƒ³ãƒˆ: "help" ã‚³ãƒãƒ³ãƒ‰ã§åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ã‚’ç¢ºèªã§ãã¾ã™', 'success-output');
        }
        
        addToLog(''); // ç©ºè¡Œã‚’è¿½åŠ 
    }
    
    // Enterã‚­ãƒ¼ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
    commandInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const input = e.target.value;
            processCommand(input);
            e.target.value = '';
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                commandInput.value = commandHistory[historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex > 0) {
                historyIndex--;
                commandInput.value = commandHistory[historyIndex];
            } else if (historyIndex === 0) {
                historyIndex = -1;
                commandInput.value = '';
            }
        }
    });
    
    // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    document.querySelector('.terminal-container').addEventListener('click', function() {
        commandInput.focus();
    });
    
    // åˆæœŸãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    commandInput.focus();
});
</script>
{% endblock %}
