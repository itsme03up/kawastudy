{% extends 'base.html' %}
{% block title %}AWSå­¦ç¿’ã‚¯ã‚¤ã‚ºï¼ˆãƒãƒ™ãƒ«é¢¨ï¼‰{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">â˜ï¸ AWSå­¦ç¿’ãƒãƒ™ãƒ«ã‚²ãƒ¼ãƒ </h2>
  <div id="aws-quiz-root"></div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

{% verbatim %}
<script type="text/babel">
function DialogueBox({ speaker, text }) {
  return (
    <div className="dialogue-box">
      <p><strong>{speaker}</strong>ã€Œ{text}ã€</p>
    </div>
  );
}

function ChoiceBox({ choices, onSelect }) {
  return (
    <div className="choices">
      {choices.map((c, i) => (
        <button key={i} onClick={() => onSelect(i)}>{c}</button>
      ))}
    </div>
  );
}

const quizData = [
  {
    question: {
      ja: "ä¼šç¤¾ã®é–‹ç™ºãƒãƒ¼ãƒ ãŒS3ãƒã‚±ãƒƒãƒˆã«ä¿å­˜ã—ãŸæ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ãŸã„ã€‚ã‚­ãƒ¼ã®è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç°¡å˜ã«è¡Œã†ã«ã¯ã©ã†ã™ã‚‹ï¼Ÿ",
      en: "Your company wants to encrypt sensitive data stored in an S3 bucket. The admin wants automatic key rotation with minimal operational overhead. What should you choose?"
    },
    choices: {
      ja: [
        "AWS KMSã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ âœ…",
        "IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã«AdministratorAccessã‚’ä»˜ä¸ã™ã‚‹",
        "S3ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹",
        "CloudFrontã§æš—å·åŒ–ã™ã‚‹ ğŸ¤£"
      ],
      en: [
        "Use AWS KMS managed keys âœ…",
        "Attach AdministratorAccess to IAM users",
        "Enable S3 versioning",
        "Encrypt with CloudFront ğŸ¤£"
      ]
    },
    answer: 0
  },
  {
    question: {
      ja: "EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚³ã‚¹ãƒˆã‚’æœ€ã‚‚åŠ¹ç‡çš„ã«å‰Šæ¸›ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ",
      en: "What is the most efficient way to reduce EC2 instance costs?"
    },
    choices: {
      ja: [
        "ãƒªã‚¶ãƒ¼ãƒ–ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ âœ…",
        "EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’å¢—ã‚„ã™",
        "Elastic IPã‚’è¿½åŠ ã™ã‚‹",
        "CloudWatchã‚’ç„¡åŠ¹åŒ–ã™ã‚‹"
      ],
      en: [
        "Use Reserved Instances âœ…",
        "Increase EBS volumes",
        "Add Elastic IPs",
        "Disable CloudWatch"
      ]
    },
    answer: 0
  }
  // ä»–ã®å•é¡Œã‚‚ã“ã“ã«è¿½åŠ 
];

function QuizApp() {
  const [lang, setLang] = React.useState("ja");
  const [current, setCurrent] = React.useState(0);
  const [score, setScore] = React.useState(0);
  const [finished, setFinished] = React.useState(false);
  const [phase, setPhase] = React.useState("question"); // "question" or "result"
  const [lastResult, setLastResult] = React.useState(null);

  const handleAnswer = (idx) => {
    if (idx === quizData[current].answer) {
      setScore(score + 1);
      setLastResult(lang === "ja" ? "æ­£è§£ã ï¼" : "That's correct!");
    } else {
      setLastResult(lang === "ja" ? "ãã‚Œã¯é•ã†ã­â€¦" : "That's not correctâ€¦");
    }
    setPhase("result");
  };

  const handleNext = () => {
    if (current + 1 < quizData.length) {
      setCurrent(current + 1);
      setPhase("question");
    } else {
      setFinished(true);
    }
  };

  if (finished) {
    return (
      <DialogueBox
        speaker="å·ç”°"
        text={
          lang === "ja"
            ? `ãŠç–²ã‚Œæ§˜ã€‚ã‚¹ã‚³ã‚¢ã¯ ${score} / ${quizData.length} ã ã€‚`
            : `Good work. Your score: ${score} / ${quizData.length}`
        }
      />
    );
  }

  return (
    <div>
      <div className="lang-toggle">
        <button onClick={() => setLang("ja")} disabled={lang === "ja"}>æ—¥æœ¬èª</button>
        <button onClick={() => setLang("en")} disabled={lang === "en"}>English</button>
      </div>

      {phase === "question" && (
        <>
          <DialogueBox speaker="å·ç”°" text={quizData[current].question[lang]} />
          <ChoiceBox choices={quizData[current].choices[lang]} onSelect={handleAnswer} />
        </>
      )}

      {phase === "result" && (
        <>
          <DialogueBox speaker="å·ç”°" text={lastResult} />
          <div className="choice-box">
            <button onClick={handleNext}>
              {lang === "ja" ? "æ¬¡ã¸" : "Next"}
            </button>
          </div>
        </>
      )}

      <div style={{ marginTop: "1em", fontSize: "0.9em", opacity: 0.7 }}>
        {lang === "ja"
          ? `ç¬¬${current + 1}å• / å…¨${quizData.length}å• ã€€æ­£è§£æ•°: ${score}`
          : `Q${current + 1} / ${quizData.length} ã€€Score: ${score}`}
      </div>
    </div>
  );
}

ReactDOM.render(<QuizApp />, document.getElementById("aws-quiz-root"));
</script>
{% endverbatim %}

<style>
.dialogue-box {
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 1em;
  border-radius: 10px;
  font-family: 'æ¸¸ã‚´ã‚·ãƒƒã‚¯', sans-serif;
  margin-top: 1em;
}
.choices button {
  display: block;
  margin: 0.5em auto;
  padding: 0.6em 1.2em;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 6px;
}
</style>
{% endblock %}