{% extends 'base.html' %}
{% load static %}

{% block title %}Cè¨€èªå…¥é–€{% endblock %}

{% block body_class %}cstudy-page{% endblock %}

{% block content %}
<header class="page-header">
    <h1>Cè¨€èªå…¥é–€</h1>
    <p>å·ç”°ã¨ä¸€ç·’ã«Cè¨€èªã®åŸºæœ¬ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼</p>
</header>

<main class="main-content">
    <div class="cstudy-layout">
        <!-- å·¦å´ï¼šå­¦ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div class="lesson-menu">
            <div class="progress-section">
                <h3>ğŸ“Š å­¦ç¿’é€²æ—</h3>
                <div class="progress-container">
                    <div class="progress-bar" id="learning-progress-bar"></div>
                </div>
                <span class="progress-text" id="progress-text">é€²æ—: 0%</span>
            </div>

            <div class="menu-section">
                <h3>ğŸ“š å­¦ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                <ul class="lesson-list">
                    <li>
                        <button class="lesson-btn active" data-lesson="intro">
                            <span class="lesson-icon">ğŸ“–</span>
                            <span class="lesson-title">ã¯ã˜ã‚ã«</span>
                            <span class="completion-status">â—‹</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="hello">
                            <span class="lesson-icon">1ï¸âƒ£</span>
                            <span class="lesson-title">Hello World</span>
                            <span class="completion-status">â—‹</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="variables">
                            <span class="lesson-icon">2ï¸âƒ£</span>
                            <span class="lesson-title">å¤‰æ•°ã¨è¨ˆç®—</span>
                            <span class="completion-status">â—‹</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="input">
                            <span class="lesson-icon">3ï¸âƒ£</span>
                            <span class="lesson-title">å…¥åŠ›ã¨å‡ºåŠ›</span>
                            <span class="completion-status">â—‹</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="strings">
                            <span class="lesson-icon">4ï¸âƒ£</span>
                            <span class="lesson-title">æ–‡å­—åˆ—ã¨é…åˆ—</span>
                            <span class="completion-status">â—‹</span>
                        </button>
                    </li>
                </ul>
            </div>

            <div class="kawada-section">
                <h3>ğŸ’¬ å·ç”°ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
                <div class="kawada-comment" id="kawada-comment">
                    <p>å­¦ç¿’ã—ãŸã„é …ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼</p>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div class="compiler-area">
            <div class="lesson-content" id="lesson-content">
                <!-- å‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
// Cè¨€èªå­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹
document.addEventListener('DOMContentLoaded', function() {
    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã®ã¿å®Ÿè¡Œ
    if (window.kawadaScheduler) {
        kawadaScheduler.startSession('cstudy', 'Cè¨€èªå…¥é–€');
    }
    
    // ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ¬ãƒƒã‚¹ãƒ³æƒ…å ±ã‚’æ›´æ–°
    document.querySelectorAll('.lesson-btn').forEach(button => {
        button.addEventListener('click', function() {
            const lessonName = this.querySelector('.lesson-title').textContent;
            if (window.kawadaScheduler) {
                kawadaScheduler.currentLesson = `Cè¨€èª - ${lessonName}`;
            }
        });
    });
    
    // å­¦ç¿’å®Œäº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('beforeunload', function() {
        if (window.kawadaScheduler && kawadaScheduler.isRecording) {
            // é€²æ—ã«å¿œã˜ã¦å®Œäº†åˆ¤å®š
            const progressElement = document.getElementById('progress-text');
            const progressText = progressElement ? progressElement.textContent : '';
            const isCompleted = progressText.includes('100%') || 
                               document.querySelectorAll('.lesson-btn.completed').length > 0;
            
            kawadaScheduler.endSession(isCompleted);
        }
    });
});

// æ—¢å­˜ã®Cè¨€èªå­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ‹¡å¼µ
// lesson completionæ™‚ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã«é€šçŸ¥
function markLessonCompleted(lessonId) {
    // æ—¢å­˜ã®å®Œäº†å‡¦ç†...
    
    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã«å®Œäº†ã‚’é€šçŸ¥
    if (window.kawadaScheduler) {
        kawadaScheduler.showKawadaMessage(
            "ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼", 
            "ãƒ¬ãƒƒã‚¹ãƒ³ã‚’å®Œäº†ã—ã¾ã—ãŸã­ï¼å·ç”°ã‚‚ã¨ã¦ã‚‚å¬‰ã—ã„ã§ã™ğŸ’•", 
            'cheerful'
        );
    }
}

// å·ç”°ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºé–¢æ•°
function showKawadaReaction(type, message) {
    if (window.kawadaScheduler) {
        kawadaScheduler.showKawadaMessage("å·ç”°ã‚ˆã‚Š", message, type);
    }
}
</script>
{% endblock %}
