{% extends 'base.html' %}
{% load static %}

{% block title %}C言語入門{% endblock %}

{% block body_class %}cstudy-unified-page{% endblock %}

{% block head %}
<style>
/* 基本スタイル */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    overflow-x: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* パララックスモードスタイル */
.parallax-mode {
    display: block;
    position: relative;
    height: 600vh;
    width: 100%;
    scroll-behavior: smooth;
}

.background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;
    overflow: visible;
}

.path, .clouds {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    will-change: transform;
}

.path {
    background-image: url('{% static "img/parallax/backgrounds/path.png" %}');
    background-color: #4a5d23;
    z-index: 1;
}

.clouds {
    background-image: url('{% static "img/parallax/backgrounds/clouds.png" %}');
    z-index: 2;
    opacity: 0.7;
}
.kawada-character {
    position: fixed;
    bottom: 30%;
    left: 50%;
    transform: translateX(-50%);
    width: 150px;
    height: 150px;
    z-index: 3;
    transition: all 0.5s ease;
    overflow: hidden;
    border-radius: 10px;
}

.kawada-character img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    display: block;
}

/* レッスンセクションは一番上 */
.lesson-sections {
    position: relative;
    z-index: 4;
}

/* レスポンシブデザイン */
@media (max-width: 768px) {
    .kawada-character {
        width: 100px;
        height: 100px;
        bottom: 25%;
    }
}
</style>
{% endblock %}

{% block content %}

<!-- パララックスモード -->
<div id="parallax-mode" class="parallax-mode">
    <div class="background-container">
        <div class="path" id="path-bg"></div>
        <div class="clouds" id="clouds-bg"></div>
        
        <div class="kawada-character" id="kawada-char">
            <img src="{% static 'img/parallax/characters/kawada-sam.png' %}" 
                 width="150" 
                 height="150" 
                 alt="川田" 
                 id="kawada-img">
        </div>
    </div>

    <!-- スクロール用セクション -->
    <div class="lesson-sections" style="position: relative; z-index: 10;">
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>🌟 C言語の世界へようこそ</h2>
                <p>スクロールしながら川田と一緒に学習の旅を始めましょう！</p>
            </div>
        </section>
        
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>📚 基本概念</h2>
                <p>C言語は1972年に開発されたプログラミング言語です。<br>システムプログラミングの基盤となる重要な言語です。</p>
            </div>
        </section>
        
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>💻 Hello World</h2>
                <p>プログラミングの第一歩！<br>まずは定番の「Hello World」から始めてみましょう。</p>
            </div>
        </section>
        
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>🔢 変数と型</h2>
                <p>データを格納する変数の概念を学び、<br>int、float、charなどの基本型を理解しましょう。</p>
            </div>
        </section>
        
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>🎯 学習完了！</h2>
                <p>お疲れさまでした！<br>川田と一緒にC言語の基礎を学びました。</p>
            </div>
        </section>
        
        <section style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div style="background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; text-align: center; max-width: 600px;">
                <h2>🚀 次のステップ</h2>
                <p>実際のコーディングに挑戦してみましょう！<br>川田がサポートします。</p>
            </div>
        </section>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 統合されたC言語学習システム
class UnifiedCStudy {
    constructor() {
        this.currentMode = 'parallax';
        this.currentLesson = null;
        this.lessonData = [];
        this.quizData = [];
        this.progress = 0;
        
        this.init();
    }
    
    async init() {
        this.initParallax(); // パララックスを自動で初期化
    }
    
    initParallax() {
        // パララックスエフェクト
        let ticking = false;
        
        const handleScroll = () => {
            if (!ticking) {
                requestAnimationFrame(() => {
                    const scrollY = window.scrollY;
                    console.log("ScrollY:", scrollY); // デバッグ用
                    const pathBg = document.getElementById('path-bg');
                    const cloudsBg = document.getElementById('clouds-bg');
                    const kawadaChar = document.getElementById('kawada-char');
                    
                    // 背景のパララックス効果
                    if (pathBg) pathBg.style.transform = `translateY(${scrollY * 0.5}px)`;
                    if (cloudsBg) cloudsBg.style.transform = `translateY(${scrollY * 0.3}px)`;
                    
                    // 川田が道を歩いているような効果
                    if (kawadaChar) {
                        const walkingOffset = Math.sin(scrollY * 0.02) * 5; // 歩行のような左右の動き
                        kawadaChar.style.transform = `translateX(calc(-50% + ${walkingOffset}px)) translateY(${scrollY * 0.1}px)`;
                    }
                    
                    ticking = false;
                });
                ticking = true;
            }
        };
        
        window.addEventListener('scroll', handleScroll, { passive: true });
        
        // 初期表示時に少しスクロールして動作を分かりやすく
        setTimeout(() => {
            window.scrollTo({ top: 1 });
        }, 100);
    }
}

// 初期化
document.addEventListener('DOMContentLoaded', () => {
    new UnifiedCStudy();
});
</script>
{% endblock %}
