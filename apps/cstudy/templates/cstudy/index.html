{% extends 'base.html' %}
{% load static %}

{% block title %}CË®ÄË™ûÂÖ•ÈñÄ{% endblock %}

{% block body_class %}cstudy-unified-page{% endblock %}

{% block head %}
<style>
/* Âü∫Êú¨„Çπ„Çø„Ç§„É´ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    overflow-x: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* „É¢„Éº„ÉâÂàáÊõø„Éú„Çø„É≥ */
.mode-selector {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    gap: 10px;
}

.mode-btn {
    padding: 8px 16px;
    border: 2px solid #007bff;
    background: rgba(255, 255, 255, 0.9);
    color: #007bff;
    cursor: pointer;
    border-radius: 20px;
    font-size: 12px;
    transition: all 0.3s ease;
}

.mode-btn.active {
    background: #007bff;
    color: white;
}

.mode-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,123,255,0.3);
}

/* Ê®ôÊ∫ñ„É¢„Éº„Éâ„Çπ„Çø„Ç§„É´ */
.standard-mode {
    display: block;
}

.standard-mode .cstudy-layout {
    display: flex;
    min-height: 100vh;
    padding: 20px;
    gap: 20px;
}

.standard-mode .lesson-menu {
    flex: 1;
    max-width: 400px;
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.standard-mode .compiler-area {
    flex: 2;
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

/* „Éë„É©„É©„ÉÉ„ÇØ„Çπ„É¢„Éº„Éâ„Çπ„Çø„Ç§„É´ */
.parallax-mode {
    display: none;
    position: relative;
    height: 400vh;
    width: 100%;
}

.background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 1;
    overflow: hidden;
}

.path {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: #4a5d23;
    background-image: url('{% static "img/parallax/backgrounds/path.png" %}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transform: translateZ(0);
    will-change: transform;
    z-index: 1;
}

.clouds {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-image: url('{% static "img/parallax/backgrounds/clouds.png" %}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transform: translateZ(0);
    will-change: transform;
    z-index: 2;
}

.kawada-character {
    position: absolute;
    bottom: 20%;
    left: 10%;
    width: 150px;
    height: 150px;
    z-index: 10;
    transition: all 0.5s ease;
}

.kawada-character img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* Â≠¶Áøí„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
.lesson-sections {
    position: relative;
    z-index: 5;
    padding: 100vh 0 50px;
}

.lesson-section {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: 50px;
}

.lesson-content-box {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    max-width: 800px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
}

.lesson-content-box.left {
    margin-left: 10%;
}

.lesson-content-box.right {
    margin-left: auto;
    margin-right: 10%;
}

.lesson-content-box.center {
    margin: 0 auto;
}

/* ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
.progress-section h3 {
    color: #007bff;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.progress-container {
    background: #e9ecef;
    border-radius: 10px;
    height: 20px;
    margin-bottom: 10px;
    overflow: hidden;
}

.progress-bar {
    background: linear-gradient(45deg, #007bff, #0056b3);
    height: 100%;
    width: 0%;
    border-radius: 10px;
    transition: width 0.5s ease;
}

.lesson-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.lesson-btn {
    width: 100%;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid #dee2e6;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 16px;
}

.lesson-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,123,255,0.3);
    border-color: #007bff;
}

.lesson-btn.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.lesson-btn.completed {
    background: #28a745;
    color: white;
    border-color: #28a745;
}

.lesson-icon {
    font-size: 24px;
    min-width: 30px;
}

.lesson-title {
    flex: 1;
    text-align: left;
}

.completion-status {
    font-size: 20px;
    min-width: 30px;
    text-align: center;
}

.kawada-comment {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 15px;
    margin-top: 20px;
}

.code-editor {
    background: #1e1e1e;
    color: #ffffff;
    border-radius: 10px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    min-height: 300px;
    margin: 20px 0;
}

.code-output {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    min-height: 100px;
    margin: 20px 0;
}

.run-btn {
    background: #28a745;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.run-btn:hover {
    background: #218838;
    transform: translateY(-2px);
}

/* „ÇØ„Ç§„Ç∫„Çπ„Çø„Ç§„É´ */
.quiz-container {
    background: rgba(255, 243, 205, 0.95);
    border-radius: 15px;
    padding: 30px;
    margin: 20px 0;
}

.quiz-options {
    list-style: none;
    margin: 20px 0;
    padding: 0;
}

.quiz-option {
    background: white;
    border: 2px solid #dee2e6;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.quiz-option:hover {
    border-color: #007bff;
    transform: translateX(5px);
}

.quiz-option.selected {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.quiz-option.correct {
    background: #28a745;
    color: white;
    border-color: #28a745;
}

.quiz-option.incorrect {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
@media (max-width: 768px) {
    .standard-mode .cstudy-layout {
        flex-direction: column;
        padding: 10px;
    }
    
    .standard-mode .lesson-menu,
    .standard-mode .compiler-area {
        max-width: none;
    }
    
    .lesson-section {
        padding: 20px;
    }
    
    .lesson-content-box.left,
    .lesson-content-box.right {
        margin-left: 5%;
        margin-right: 5%;
    }
    
    .mode-selector {
        top: 10px;
        right: 10px;
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- „É¢„Éº„ÉâÂàáÊõø„Éú„Çø„É≥ -->
<div class="mode-selector">
    <button class="mode-btn active" data-mode="standard">üìö Ê®ôÊ∫ñ„É¢„Éº„Éâ</button>
    <button class="mode-btn" data-mode="parallax">üåÑ „Éë„É©„É©„ÉÉ„ÇØ„Çπ</button>
</div>

<!-- Ê®ôÊ∫ñ„É¢„Éº„Éâ -->
<div id="standard-mode" class="standard-mode">
    <header class="page-header">
        <h1>CË®ÄË™ûÂÖ•ÈñÄ</h1>
        <p>Â∑ùÁî∞„Å®‰∏ÄÁ∑í„Å´CË®ÄË™û„ÅÆÂü∫Êú¨„ÇíÂ≠¶„Å≥„Åæ„Åó„Çá„ÅÜÔºÅ</p>
    </header>

    <main class="main-content">
        <div class="cstudy-layout">
            <!-- Â∑¶ÂÅ¥ÔºöÂ≠¶Áøí„É°„Éã„É•„Éº -->
            <div class="lesson-menu">
                <div class="progress-section">
                    <h3>üìä Â≠¶ÁøíÈÄ≤Êçó</h3>
                    <div class="progress-container">
                        <div class="progress-bar" id="learning-progress-bar"></div>
                    </div>
                    <span class="progress-text" id="progress-text">ÈÄ≤Êçó: 0%</span>
                </div>

                <div class="menu-section">
                    <h3>üìö Â≠¶Áøí„É°„Éã„É•„Éº</h3>
                    <ul class="lesson-list">
                        <li>
                            <button class="lesson-btn active" data-lesson="intro">
                                <span class="lesson-icon">üìñ</span>
                                <span class="lesson-title">„ÅØ„Åò„ÇÅ„Å´</span>
                                <span class="completion-status">‚óã</span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="hello">
                                <span class="lesson-icon">1Ô∏è‚É£</span>
                                <span class="lesson-title">Hello World</span>
                                <span class="completion-status">‚óã</span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="variables">
                                <span class="lesson-icon">2Ô∏è‚É£</span>
                                <span class="lesson-title">Â§âÊï∞„Å®Ë®àÁÆó</span>
                                <span class="completion-status">‚óã</span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="input">
                                <span class="lesson-icon">3Ô∏è‚É£</span>
                                <span class="lesson-title">ÂÖ•Âäõ„Å®Âá∫Âäõ</span>
                                <span class="completion-status">‚óã</span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="strings">
                                <span class="lesson-icon">4Ô∏è‚É£</span>
                                <span class="lesson-title">ÊñáÂ≠óÂàó„Å®ÈÖçÂàó</span>
                                <span class="completion-status">‚óã</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="kawada-section">
                    <h3>üí¨ Â∑ùÁî∞„Åã„Çâ„ÅÆ„Ç≥„É°„É≥„Éà</h3>
                    <div class="kawada-comment" id="kawada-comment">
                        <p>Â≠¶Áøí„Åó„Åü„ÅÑÈ†ÖÁõÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ</p>
                    </div>
                </div>
            </div>

            <!-- Âè≥ÂÅ¥Ôºö„Ç≥„É≥„Éë„Ç§„É©„Éº„Ç®„É™„Ç¢ -->
            <div class="compiler-area">
                <div class="lesson-content" id="lesson-content">
                    <h2>CË®ÄË™ûÂ≠¶Áøí„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</h2>
                    <p>Â∑¶ÂÅ¥„ÅÆ„É°„Éã„É•„Éº„Åã„ÇâÂ≠¶Áøí„Åó„Åü„ÅÑÈ†ÖÁõÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    
                    <div class="code-editor" id="code-editor" contenteditable="true">
#include &lt;stdio.h&gt;

int main() {
    printf("Hello, World!\n");
    return 0;
}
                    </div>
                    
                    <button class="run-btn" onclick="runCode()">‚ñ∂Ô∏è ÂÆüË°å</button>
                    
                    <div class="code-output" id="code-output">
                        ÂÆüË°åÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- „Éë„É©„É©„ÉÉ„ÇØ„Çπ„É¢„Éº„Éâ -->
<div id="parallax-mode" class="parallax-mode">
    <div class="background-container">
        <div class="path" id="path-bg"></div>
        <div class="clouds" id="clouds-bg"></div>
        
        <div class="kawada-character" id="kawada-char">
            <img src="{% static 'img/kawada-default.png' %}" alt="Â∑ùÁî∞" id="kawada-img">
        </div>
    </div>

    <div class="lesson-sections" id="lesson-sections">
        <!-- ÂãïÁöÑ„Å´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåÁîüÊàê„Åï„Çå„Çã -->
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Áµ±Âêà„Åï„Çå„ÅüCË®ÄË™ûÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†
class UnifiedCStudy {
    constructor() {
        this.currentMode = 'standard';
        this.currentLesson = null;
        this.lessonData = [];
        this.quizData = [];
        this.progress = 0;
        
        this.init();
    }
    
    async init() {
        this.setupModeToggle();
        this.setupLessonButtons();
        await this.loadLessonData();
        await this.loadQuizData();
        this.initKawadaScheduler();
    }
    
    setupModeToggle() {
        const modeButtons = document.querySelectorAll('.mode-btn');
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.dataset.mode;
                this.switchMode(mode);
                
                // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
                modeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
    }
    
    switchMode(mode) {
        const standardMode = document.getElementById('standard-mode');
        const parallaxMode = document.getElementById('parallax-mode');
        
        if (mode === 'parallax') {
            standardMode.style.display = 'none';
            parallaxMode.style.display = 'block';
            this.currentMode = 'parallax';
            this.initParallax();
        } else {
            standardMode.style.display = 'block';
            parallaxMode.style.display = 'none';
            this.currentMode = 'standard';
        }
    }
    
    initParallax() {
        // „Éë„É©„É©„ÉÉ„ÇØ„Çπ„Ç®„Éï„Çß„ÇØ„Éà
        const handleScroll = () => {
            const scrollY = window.scrollY;
            const pathBg = document.getElementById('path-bg');
            const cloudsBg = document.getElementById('clouds-bg');
            const kawadaChar = document.getElementById('kawada-char');
            
            if (pathBg) pathBg.style.transform = `translateY(${scrollY * 0.5}px)`;
            if (cloudsBg) cloudsBg.style.transform = `translateY(${scrollY * 0.3}px)`;
            if (kawadaChar) {
                kawadaChar.style.transform = `translateY(${scrollY * 0.1}px)`;
            }
        };
        
        window.addEventListener('scroll', handleScroll);
        this.generateParallaxContent();
    }
    
    async generateParallaxContent() {
        const container = document.getElementById('lesson-sections');
        container.innerHTML = '';
        
        const lessons = [
            { title: 'CË®ÄË™û„Å®„ÅØ', content: 'CË®ÄË™û„ÅØ1972Âπ¥„Å´„Éá„Éã„Çπ„Éª„É™„ÉÉ„ÉÅ„Éº„Å´„Çà„Å£„Å¶ÈñãÁô∫„Åï„Çå„Åü„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Ë®ÄË™û„Åß„Åô„ÄÇ', side: 'left' },
            { title: 'Hello World', content: '„Åæ„Åö„ÅØÂÆöÁï™„ÅÆ„ÄåHello World„Äç„Éó„É≠„Ç∞„É©„É†„Åã„ÇâÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ', side: 'right' },
            { title: 'Â§âÊï∞„Å®Âûã', content: 'CË®ÄË™û„Åß„ÅØÊßò„ÄÖ„Å™„Éá„Éº„ÇøÂûã„Çí‰Ωø„Å£„Å¶Â§âÊï∞„ÇíÂÆ£Ë®Ä„Åß„Åç„Åæ„Åô„ÄÇ', side: 'center' },
            { title: 'Èñ¢Êï∞„ÅÆÂü∫Êú¨', content: 'Èñ¢Êï∞„Çí‰Ωø„Å£„Å¶„Ç≥„Éº„Éâ„ÇíÊï¥ÁêÜ„Åó„ÄÅÂÜçÂà©Áî®ÂèØËÉΩ„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ', side: 'left' }
        ];
        
        lessons.forEach((lesson, index) => {
            const section = document.createElement('div');
            section.className = 'lesson-section';
            section.innerHTML = `
                <div class="lesson-content-box ${lesson.side}">
                    <h2>${lesson.title}</h2>
                    <p>${lesson.content}</p>
                    <div class="code-editor">
                        <code>// „Åì„Åì„Å´„Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</code>
                    </div>
                </div>
            `;
            container.appendChild(section);
        });
    }
    
    setupLessonButtons() {
        const buttons = document.querySelectorAll('.lesson-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const lesson = btn.dataset.lesson;
                this.selectLesson(lesson);
                
                // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
                buttons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });
    }
    
    selectLesson(lessonId) {
        this.currentLesson = lessonId;
        this.updateLessonContent(lessonId);
        this.updateKawadaComment(lessonId);
        
        // „Çπ„Ç±„Ç∏„É•„Éº„É©„Éº„Å´ÈÄöÁü•
        if (window.kawadaScheduler) {
            kawadaScheduler.currentLesson = `CË®ÄË™û - ${lessonId}`;
        }
    }
    
    updateLessonContent(lessonId) {
        const content = document.getElementById('lesson-content');
        const lessons = {
            intro: {
                title: 'CË®ÄË™ûÂÖ•ÈñÄ',
                description: 'CË®ÄË™û„ÅÆÂü∫Êú¨Ê¶ÇÂøµ„ÇíÂ≠¶„Å≥„Åæ„Åó„Çá„ÅÜ',
                code: '#include <stdio.h>\n\nint main() {\n    printf("CË®ÄË™ûÂ≠¶ÁøíÈñãÂßãÔºÅ\\n");\n    return 0;\n}'
            },
            hello: {
                title: 'Hello World',
                description: 'ÊúÄÂàù„ÅÆCË®ÄË™û„Éó„É≠„Ç∞„É©„É†„ÇíÊõ∏„ÅÑ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ',
                code: '#include <stdio.h>\n\nint main() {\n    printf("Hello, World!\\n");\n    return 0;\n}'
            },
            variables: {
                title: 'Â§âÊï∞„Å®Ë®àÁÆó',
                description: 'Â§âÊï∞„Çí‰Ωø„Å£„Å¶Ë®àÁÆó„Çí„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ',
                code: '#include <stdio.h>\n\nint main() {\n    int a = 10;\n    int b = 20;\n    int sum = a + b;\n    printf("ÂêàË®à: %d\\n", sum);\n    return 0;\n}'
            },
            input: {
                title: 'ÂÖ•Âäõ„Å®Âá∫Âäõ',
                description: '„É¶„Éº„Ç∂„Éº„Åã„Çâ„ÅÆÂÖ•Âäõ„ÇíÂèó„ÅëÂèñ„Å£„Å¶„Åø„Åæ„Åó„Çá„ÅÜ',
                code: '#include <stdio.h>\n\nint main() {\n    int number;\n    printf("Êï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ: ");\n    scanf("%d", &number);\n    printf("ÂÖ•Âäõ„Åï„Çå„ÅüÊï∞Â≠ó: %d\\n", number);\n    return 0;\n}'
            },
            strings: {
                title: 'ÊñáÂ≠óÂàó„Å®ÈÖçÂàó',
                description: 'ÊñáÂ≠óÂàó„Å®ÈÖçÂàó„ÅÆÂü∫Êú¨Êìç‰Ωú„ÇíÂ≠¶„Å≥„Åæ„Åó„Çá„ÅÜ',
                code: '#include <stdio.h>\n#include <string.h>\n\nint main() {\n    char name[50];\n    printf("„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ: ");\n    scanf("%s", name);\n    printf("„Åì„Çì„Å´„Å°„ÅØ„ÄÅ%s„Åï„ÇìÔºÅ\\n", name);\n    return 0;\n}'
            }
        };
        
        const lesson = lessons[lessonId] || lessons.intro;
        
        content.innerHTML = `
            <h2>${lesson.title}</h2>
            <p>${lesson.description}</p>
            <div class="code-editor" id="code-editor" contenteditable="true">${lesson.code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
            <button class="run-btn" onclick="runCode()">‚ñ∂Ô∏è ÂÆüË°å</button>
            <div class="code-output" id="code-output">ÂÆüË°åÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...</div>
        `;
    }
    
    updateKawadaComment(lessonId) {
        const comment = document.getElementById('kawada-comment');
        const comments = {
            intro: 'CË®ÄË™ûÂ≠¶Áøí„ÅÆÂßã„Åæ„Çä„Åß„Åô„Å≠ÔºÅ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜüí™',
            hello: 'Hello World„ÅØÂÖ®„Å¶„ÅÆÂßã„Åæ„ÇäÔºÅ„Åæ„Åö„ÅØ„Åì„Åì„Åã„ÇâÊÖ£„Çå„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜüòä',
            variables: 'Â§âÊï∞„ÅØ „Éó„É≠„Ç∞„É©„É†„ÅÆÂü∫Êú¨‰∏≠„ÅÆÂü∫Êú¨„Åß„Åô„ÄÇ„Åó„Å£„Åã„ÇäÁêÜËß£„Åó„Åæ„Åó„Çá„ÅÜüìù',
            input: '„É¶„Éº„Ç∂„Éº„Å®„ÅÆÂØæË©±„Åå„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÇàÔºÅÊ•Ω„Åó„Åè„Å™„Å£„Å¶„Åç„Åæ„Åó„Åü‚ú®',
            strings: 'ÊñáÂ≠óÂàóÊìç‰Ωú„ÅØ„Å®„Å¶„ÇÇÈáçË¶Å„Åß„Åô„ÄÇÊÖéÈáç„Å´Â≠¶Áøí„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜüî§'
        };
        
        comment.innerHTML = `<p>${comments[lessonId] || '„Åå„Çì„Å∞„Å£„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅ'}</p>`;
    }
    
    async loadLessonData() {
        try {
            const response = await fetch('/cstudy/api/lessons/');
            if (response.ok) {
                this.lessonData = await response.json();
            }
        } catch (error) {
            console.log('„É¨„ÉÉ„Çπ„É≥„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
        }
    }
    
    async loadQuizData() {
        try {
            const response = await fetch('/cstudy/api/quizzes/');
            if (response.ok) {
                this.quizData = await response.json();
            }
        } catch (error) {
            console.log('„ÇØ„Ç§„Ç∫„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
        }
    }
    
    initKawadaScheduler() {
        // „Çπ„Ç±„Ç∏„É•„Éº„É©„Éº„ÅåÂà©Áî®ÂèØËÉΩ„Å™Â†¥Âêà„ÅÆ„ÅøÂÆüË°å
        if (window.kawadaScheduler) {
            kawadaScheduler.startSession('cstudy', 'CË®ÄË™ûÂÖ•ÈñÄ');
        }
        
        // „Çª„ÉÉ„Ç∑„Éß„É≥ÁµÇ‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
        window.addEventListener('beforeunload', () => {
            if (window.kawadaScheduler && kawadaScheduler.isRecording) {
                const isCompleted = this.progress >= 100;
                kawadaScheduler.endSession(isCompleted);
            }
        });
    }
    
    updateProgress(percentage) {
        this.progress = percentage;
        const progressBar = document.getElementById('learning-progress-bar');
        const progressText = document.getElementById('progress-text');
        
        if (progressBar) progressBar.style.width = `${percentage}%`;
        if (progressText) progressText.textContent = `ÈÄ≤Êçó: ${percentage}%`;
    }
    
    markLessonCompleted(lessonId) {
        const button = document.querySelector(`[data-lesson="${lessonId}"]`);
        if (button) {
            button.classList.add('completed');
            button.querySelector('.completion-status').textContent = '‚úì';
        }
        
        // ÈÄ≤ÊçóÊõ¥Êñ∞
        const completedLessons = document.querySelectorAll('.lesson-btn.completed').length;
        const totalLessons = document.querySelectorAll('.lesson-btn').length;
        const progress = Math.round((completedLessons / totalLessons) * 100);
        this.updateProgress(progress);
        
        // Â∑ùÁî∞„ÅÆ„É™„Ç¢„ÇØ„Ç∑„Éß„É≥
        if (window.kawadaScheduler) {
            kawadaScheduler.showKawadaMessage(
                "„ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åó„ÅüÔºÅ", 
                "„É¨„ÉÉ„Çπ„É≥„ÇíÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„Å≠ÔºÅÂ∑ùÁî∞„ÇÇ„Å®„Å¶„ÇÇÂ¨â„Åó„ÅÑ„Åß„Åôüíï", 
                'cheerful'
            );
        }
    }
}

// „Ç≥„Éº„ÉâÂÆüË°åÊ©üËÉΩ
async function runCode() {
    const codeEditor = document.getElementById('code-editor');
    const output = document.getElementById('code-output');
    
    if (!codeEditor || !output) return;
    
    const code = codeEditor.textContent || codeEditor.innerText;
    output.textContent = 'ÂÆüË°å‰∏≠...';
    
    try {
        const response = await fetch('/cstudy/api/run-code/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
            },
            body: JSON.stringify({ source: code })
        });
        
        const result = await response.json();
        
        if (result.stdout) {
            output.innerHTML = `<strong>ÂÆüË°åÁµêÊûú:</strong><br><pre>${result.stdout}</pre>`;
        } else if (result.stderr) {
            output.innerHTML = `<strong>„Ç®„É©„Éº:</strong><br><pre style="color: red;">${result.stderr}</pre>`;
        } else {
            output.textContent = 'Âá∫Âäõ„Å™„Åó';
        }
    } catch (error) {
        output.innerHTML = `<strong>„Ç®„É©„Éº:</strong><br><pre style="color: red;">${error.message}</pre>`;
    }
}

// ÂàùÊúüÂåñ
document.addEventListener('DOMContentLoaded', () => {
    new UnifiedCStudy();
});
</script>
{% endblock %}
