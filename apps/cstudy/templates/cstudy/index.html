{% extends 'base.html' %}
{% load static %}

{% block title %}C言語入門{% endblock %}

{% block body_class %}cstudy-page{% endblock %}

{% block content %}
<header class="page-header">
    <h1>C言語入門</h1>
    <p>川田と一緒にC言語の基本を学びましょう！</p>
</header>

<main class="main-content">
    <div class="cstudy-layout">
        <!-- 左側：学習メニュー -->
        <div class="lesson-menu">
            <div class="progress-section">
                <h3>📊 学習進捗</h3>
                <div class="progress-container">
                    <div class="progress-bar" id="learning-progress-bar"></div>
                </div>
                <span class="progress-text" id="progress-text">進捗: 0%</span>
            </div>

            <div class="menu-section">
                <h3>📚 学習メニュー</h3>
                <ul class="lesson-list">
                    <li>
                        <button class="lesson-btn active" data-lesson="intro">
                            <span class="lesson-icon">📖</span>
                            <span class="lesson-title">はじめに</span>
                            <span class="completion-status">○</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="hello">
                            <span class="lesson-icon">1️⃣</span>
                            <span class="lesson-title">Hello World</span>
                            <span class="completion-status">○</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="variables">
                            <span class="lesson-icon">2️⃣</span>
                            <span class="lesson-title">変数と計算</span>
                            <span class="completion-status">○</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="input">
                            <span class="lesson-icon">3️⃣</span>
                            <span class="lesson-title">入力と出力</span>
                            <span class="completion-status">○</span>
                        </button>
                    </li>
                    <li>
                        <button class="lesson-btn" data-lesson="strings">
                            <span class="lesson-icon">4️⃣</span>
                            <span class="lesson-title">文字列と配列</span>
                            <span class="completion-status">○</span>
                        </button>
                    </li>
                </ul>
            </div>

            <div class="kawada-section">
                <h3>💬 川田からのコメント</h3>
                <div class="kawada-comment" id="kawada-comment">
                    <p>学習したい項目をクリックしてください！</p>
                </div>
            </div>
        </div>

        <!-- 右側：コンパイラーエリア -->
        <div class="compiler-area">
            <div class="lesson-content" id="lesson-content">
                <!-- 動的にコンテンツが挿入される -->
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
// C言語学習セッションの開始
document.addEventListener('DOMContentLoaded', function() {
    // スケジューラーが利用可能な場合のみ実行
    if (window.kawadaScheduler) {
        kawadaScheduler.startSession('cstudy', 'C言語入門');
    }
    
    // レッスンボタンのクリック時にレッスン情報を更新
    document.querySelectorAll('.lesson-btn').forEach(button => {
        button.addEventListener('click', function() {
            const lessonName = this.querySelector('.lesson-title').textContent;
            if (window.kawadaScheduler) {
                kawadaScheduler.currentLesson = `C言語 - ${lessonName}`;
            }
        });
    });
    
    // 学習完了時のイベント
    window.addEventListener('beforeunload', function() {
        if (window.kawadaScheduler && kawadaScheduler.isRecording) {
            // 進捗に応じて完了判定
            const progressElement = document.getElementById('progress-text');
            const progressText = progressElement ? progressElement.textContent : '';
            const isCompleted = progressText.includes('100%') || 
                               document.querySelectorAll('.lesson-btn.completed').length > 0;
            
            kawadaScheduler.endSession(isCompleted);
        }
    });
});

// 既存のC言語学習スクリプトを拡張
// lesson completion時にスケジューラーに通知
function markLessonCompleted(lessonId) {
    // 既存の完了処理...
    
    // スケジューラーに完了を通知
    if (window.kawadaScheduler) {
        kawadaScheduler.showKawadaMessage(
            "お疲れさまでした！", 
            "レッスンを完了しましたね！川田もとても嬉しいです💕", 
            'cheerful'
        );
    }
}

// 川田のリアクション表示関数
function showKawadaReaction(type, message) {
    if (window.kawadaScheduler) {
        kawadaScheduler.showKawadaMessage("川田より", message, type);
    }
}
</script>
{% endblock %}
