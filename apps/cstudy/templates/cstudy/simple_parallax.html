{% extends 'base.html' %}
{% load static %}

{% block title %}C言語学習 - シンプルパララックス{% endblock %}

{% block body_class %}cstudy-simple-parallax-page{% endblock %}

{% block head %}
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    overflow-x: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.parallax-container {
    position: relative;
    height: 400vh; /* 長いスクロール可能領域 */
    width: 100%;
}

.background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 1;
}

.path {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: #4a5d23; /* フォールバック背景色 */
    background-image: url('{% static "img/parallax/backgrounds/path.png" %}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transform: translateZ(0);
    will-change: transform;
    z-index: 1;
}

.character-sticky {
    position: fixed;
    top: 12%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    transition: all 0.3s ease;
}

.kawada-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 4px solid #fff;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    background: white;
    transition: all 0.3s ease;
    object-fit: cover;
    display: block;
}

.progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    z-index: 30;
    transform-origin: left;
    transform: scaleX(0);
    transition: transform 0.1s ease;
}

.scroll-indicator {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 20;
    color: rgba(255,255,255,0.8);
    font-size: 14px;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 10px;
}

.debug-info {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 50;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 10px;
    border-radius: 5px;
    font-family: monospace;
    font-size: 12px;
}
</style>
{% endblock %}

{% block content %}
<div class="parallax-container">
    <!-- 背景画像 -->
    <div class="background-container">
        <div class="path"></div>
    </div>

    <!-- キャラクター -->
    <div class="character-sticky">
        <img src="{% static 'img/parallax/characters/kawada-sam.png' %}" 
             alt="川田先生" 
             class="kawada-avatar" 
             id="kawada-avatar">
    </div>

    <!-- プログレスバー -->
    <div class="progress-bar" id="progress-bar"></div>
    
    <!-- スクロールインジケーター -->
    <div class="scroll-indicator">
        スクロールして進む
    </div>

    <!-- デバッグ情報 -->
    <div class="debug-info" id="debug-info">
        スクロール位置: 0px
    </div>
</div>

<script>
// シンプルなスクロール処理
function handleScroll() {
    const scrollY = window.scrollY;
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    const progress = Math.min(scrollY / maxScroll, 1);
    
    // デバッグ情報更新
    document.getElementById('debug-info').textContent = `スクロール位置: ${scrollY}px, 進行度: ${Math.round(progress * 100)}%`;
    
    // プログレスバー更新
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.transform = `scaleX(${progress})`;
    
    // シンプルなパララックス効果
    const pathLayer = document.querySelector('.path');
    pathLayer.style.transform = `translateY(${scrollY * 0.3}px)`;
}

// 初期化
function initializeSimpleParallax() {
    console.log('Simple parallax initialized');
    
    // スクロールイベント
    window.addEventListener('scroll', handleScroll);
    
    // 初期状態の設定
    handleScroll();
}

// ページ読み込み完了後に初期化
document.addEventListener('DOMContentLoaded', initializeSimpleParallax);
</script>
{% endblock %}
